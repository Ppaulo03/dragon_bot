{% extends "layout.j2" %}

{% block title %}Editar Perfil | {{ user.name }}{% endblock %}

{% block finance_content %}
<article style="max-width: 600px; margin: 0 auto;">
    <header>
        <hgroup>
            <h1>Configura√ß√µes do Perfil</h1>
            <p>ID: {{ user.id }} (WhatsApp)</p>
        </hgroup>
    </header>

    <form id="editUserForm">
        <label for="name">Nome do Perfil</label>
        <input type="text" id="name" name="name" value="{{ user.name }}" required
            style="padding: 0.75rem 1rem; height: auto;">

        <div class="grid">
            <button type="submit">Salvar Altera√ß√µes</button>
            <button type="button" class="outline contrast" onclick="deleteUser()">Deletar Usu√°rio</button>
        </div>
    </form>
</article>

{% block extra_scripts %}
<script>
    document.getElementById('editUserForm').onsubmit = async (e) => {
        e.preventDefault();
        const name = document.getElementById('name').value;
        const res = await fetch(`/api/internal/finance/users/{{ user.id }}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: name })
        });
        if (res.ok) {
            alert("Perfil atualizado!");
            window.location.href = "/finance";
        }
    };

    // Deletar Usu√°rio
    async function deleteUser() {
        if (confirm("üö® ATEN√á√ÉO: Isso apagar√° o usu√°rio e todos os seus v√≠nculos com as contas. As transa√ß√µes N√ÉO ser√£o apagadas, mas perder√£o a conex√£o com este perfil. Continuar?")) {
            const res = await fetch(`/api/internal/finance/users/{{ user.id }}`, { method: 'DELETE' });
            if (res.ok) window.location.href = "/finance";
        }
    }
</script>
{% endblock %}
{% endblock %}
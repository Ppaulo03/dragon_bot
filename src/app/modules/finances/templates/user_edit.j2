{% extends "layout.j2" %}

{% block extra_head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static_finance', path='css/user_edit.css') }}">
{% endblock %}


{% block finance_content %}
<section class="edit-section">
    <article class="edit-card">
        <div class="card-header">
            <div class="header-info">
                <kbd class="user-badge-id">ID: {{ user.id }}</kbd>
            </div>
        </div>

        <form id="editUserForm" class="profile-form">
            <div class="form-group">
                <label for="name">Nome do Perfil</label>
                <input type="text" id="name" name="name" value="{{ user.name }}" required
                    placeholder="Ex: Pedro Administrador">
            </div>

            <div class="form-actions grid">
                <button type="submit" class="btn-save">Salvar Altera√ß√µes</button>
                <button type="button" class="btn-delete outline contrast" onclick="deleteUser()">
                    Deletar Usu√°rio
                </button>
            </div>
        </form>
    </article>
</section>

{% block extra_scripts %}
<script>
    document.getElementById('editUserForm').onsubmit = async (e) => {
        e.preventDefault();
        const name = document.getElementById('name').value;
        const res = await fetch(`/api/internal/finance/users/{{ user.id }}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: name })
        });
        if (res.ok) {
            alert("Perfil atualizado!");
            window.location.href = "/finance";
        }
    };

    // Deletar Usu√°rio
    async function deleteUser() {
        if (confirm("üö® ATEN√á√ÉO: Isso apagar√° o usu√°rio e todos os seus v√≠nculos com as contas. As transa√ß√µes N√ÉO ser√£o apagadas, mas perder√£o a conex√£o com este perfil. Continuar?")) {
            const res = await fetch(`/api/internal/finance/users/{{ user.id }}`, { method: 'DELETE' });
            if (res.ok) window.location.href = "/finance";
        }
    }
</script>
{% endblock %}
{% endblock %}
<div class="edit-form-wrapper fade-in">
    <header class="form-header"
        style="margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
        <h2>{{ "Editar: " ~ acc.name if acc else "Nova Conta Banc√°ria" }}</h2>
    </header>

    <form action="/finance/accounts/save" method="POST" class="dragon-form"
        style="display: flex; flex-direction: column; gap: 1.5rem;">
        {% if acc %}
        <input type="hidden" name="account_id" value="{{ acc.id }}">
        {% endif %}

        <div class="form-row" style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label>Nome da Institui√ß√£o</label>
                <input type="text" name="name" value="{{ acc.name if acc else '' }}" placeholder="Ex: Nubank" required
                    class="full-width">
            </div>
            <div class="form-group">
                <label>Saldo Inicial (R$)</label>
                <input type="number" name="initial_balance" step="0.01"
                    value="{{ (acc.initial_balance_cents / 100) if acc else 0.0 }}" required class="full-width">
            </div>
        </div>

        <div class="form-group">
            <label>Template de Importa√ß√£o Padr√£o</label>
            <select name="default_template_id" class="full-width">
                <option value="">Nenhum template selecionado</option>
                {% for tmp in templates %}
                <option value="{{ tmp.id }}" {% if acc and acc.default_template_id==tmp.id %}selected{% endif %}>
                    üìÑ {{ tmp.name }}
                </option>
                {% endfor %}
            </select>
            <small class="text-muted">Define como os arquivos CSV desta conta ser√£o lidos.</small>
        </div>

        <div class="form-group">
            <label>Usu√°rios com Acesso</label>
            <div class="user-selection-grid"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; background: var(--bg-body); padding: 1rem; border-radius: 8px; border: 1px solid var(--border);">
                {% for user_item in all_users %}
                <label class="checkbox-item" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="user_ids" value="{{ user_item.id }}" {% if acc and user_item in
                        acc.users %}checked{% endif %}>
                    <span style="font-size: 0.9rem;">{{ user_item.name or user_item.display_name }}</span>
                </label>
                {% endfor %}
            </div>
            <small class="text-muted">Apenas os usu√°rios marcados poder√£o ver as transa√ß√µes desta conta.</small>
        </div>

        <div class="form-actions"
            style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border);">
            <button type="submit" class="btn-primary">
                {{ "Salvar Altera√ß√µes" if acc else "Criar Conta" }}
            </button>

            {% if acc %}
            <button type="button" class="btn-danger-outline" hx-delete="/finance/accounts/{{ acc.id }}"
                hx-confirm="Isso apagar√° permanentemente a conta e todas as transa√ß√µes. Confirmar?" hx-target="body"
                style="margin-left: auto;">
                Deletar Conta
            </button>
            {% endif %}
        </div>
    </form>
</div>
<div class="edit-form-wrapper fade-in">
    <header class="form-header">
        <h2>{{ "Editar: " ~ acc.name if acc else "Nova Conta Banc√°ria" }}</h2>
    </header>

    <form action="/finance/accounts/save" method="POST" class="dragon-form">
        {% if acc %}
        <input type="hidden" name="account_id" value="{{ acc.id }}">
        {% endif %}

        <div class="form-row">
            <div class="form-group">
                <label>Nome da Institui√ß√£o</label>
                <input type="text" name="name" value="{{ acc.name if acc else '' }}" placeholder="Ex: Nubank" required
                    class="full-width">
            </div>
            <div class="form-group">
                <label>Saldo Inicial (R$)</label>
                <input type="number" name="initial_balance" step="0.01"
                    value="{{ (acc.initial_balance_cents / 100) if acc else 0.0 }}" required class="full-width">
            </div>
        </div>

        <div class="form-group">
            <label>Template de Importa√ß√£o Padr√£o</label>
            <select name="default_template_id" class="full-width">
                <option value="">Nenhum template selecionado</option>
                {% for tmp in templates %}
                <option value="{{ tmp.id }}" {% if acc and acc.default_template_id==tmp.id %}selected{% endif %}>
                    üìÑ {{ tmp.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>Usu√°rios com Acesso</label>
            <div class="user-selection-grid">
                {% set active_user_ids = acc.users | map(attribute='id') | list if acc else [] %}
                {% for user_item in all_users %}
                <label class="checkbox-item">
                    <input type="checkbox" name="user_ids" value="{{ user_item.id }}" {% if user_item.id in
                        active_user_ids %}checked{% endif %}>
                    <span>{{ user_item.name or user_item.display_name }}</span>
                </label>
                {% endfor %}
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">
                {{ "Salvar Altera√ß√µes" if acc else "Criar Conta" }}
            </button>

            {% if acc %}
            <button type="button" class="btn-danger-outline" hx-delete="/finance/accounts/{{ acc.id }}"
                hx-confirm="Isso apagar√° permanentemente a conta e todas as transa√ß√µes. Confirmar?" hx-target="body">
                Deletar Conta
            </button>
            {% endif %}
        </div>
    </form>
</div>
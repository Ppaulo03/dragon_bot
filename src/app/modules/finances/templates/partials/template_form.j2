<div class="edit-form-wrapper fade-in">
    <header class="form-header">
        <h2>{{ "Editar: " ~ tmp.name if tmp else "Novo Template de CSV" }}</h2>
    </header>

    <form action="/finance/templates/save" method="POST" class="dragon-form">
        {% if tmp %}<input type="hidden" name="template_id" value="{{ tmp.id }}">{% endif %}

        <div class="form-section-title">üîç Identifica√ß√£o Autom√°tica</div>
        <div class="form-row">
            <div class="form-group">
                <label>Nome do Template</label>
                <input type="text" name="name" value="{{ tmp.name if tmp else '' }}" placeholder="Ex: Nubank Fatura"
                    required>
            </div>
            <div class="form-group">
                <label>Regex Nome do Arquivo</label>
                <input type="text" name="csv_name_pattern" value="{{ tmp.csv_name_pattern if tmp else '' }}"
                    placeholder="extrato_.*\.csv">
            </div>
        </div>
        <div class="form-group">
            <label>Cabe√ßalho Esperado (Header Original)</label>
            <input type="text" name="expected_header" value="{{ tmp.expected_header if tmp else '' }}"
                placeholder="data,valor,identificador,descricao">
        </div>

        <div class="form-section-title">üèóÔ∏è Estrutura e Formata√ß√£o</div>
        <div class="form-grid-3">
            <div class="form-group">
                <label>Delimitador</label>
                <input type="text" name="delimiter" value="{{ tmp.delimiter if tmp else ';' }}" required maxlength="5">
            </div>
            <div class="form-group">
                <label>Separador Decimal</label>
                <select name="decimal_separator">
                    <option value="," {% if tmp and tmp.decimal_separator==',' %}selected{% endif %}>V√≠rgula (,)
                    </option>
                    <option value="." {% if tmp and tmp.decimal_separator=='.' %}selected{% endif %}>Ponto (.)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Pular Linhas</label>
                <input type="number" name="skip_rows" value="{{ tmp.skip_rows if tmp else 1 }}">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Formato da Data</label>
                <input type="text" name="date_format" value="{{ tmp.date_format if tmp else '%d/%m/%Y' }}" required>
            </div>
            <div class="form-group">
                <label>Sinal do Saldo</label>
                <select name="is_income_positive">
                    <option value="true" {% if not tmp or tmp.is_income_positive %}selected{% endif %}>Receitas
                        Positivas (+)</option>
                    <option value="false" {% if tmp and not tmp.is_income_positive %}selected{% endif %}>Receitas
                        Negativas (-)</option>
                </select>
            </div>
        </div>

        <div class="form-section-title">üó∫Ô∏è Mapeamento de Colunas (√çndices)</div>
        <div class="form-grid-4">
            <div class="form-group">
                <label>Coluna Data</label>
                <input type="number" name="date_column_index" value="{{ tmp.date_column_index if tmp else 0 }}"
                    required>
            </div>
            <div class="form-group">
                <label>Coluna Valor</label>
                <input type="number" name="amount_column_index" value="{{ tmp.amount_column_index if tmp else 1 }}"
                    required>
            </div>
            <div class="form-group">
                <label>Coluna Descri√ß√£o</label>
                <input type="number" name="description_column_index"
                    value="{{ tmp.description_column_index if tmp else 2 }}" required>
            </div>
            <div class="form-group">
                <label>Coluna Contraparte</label>
                <input type="number" name="counterpart_column_index"
                    value="{{ tmp.counterpart_column_index if tmp else '' }}" placeholder="Opcional">
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">
                <span>üíæ</span> {{ "Salvar Template" if tmp else "Criar Template" }}
            </button>
            {% if tmp %}
            <button type="button" class="btn-danger-outline" hx-delete="/finance/templates/{{ tmp.id }}"
                hx-confirm="Excluir este template?">
                Deletar
            </button>
            {% endif %}
        </div>
    </form>
</div>
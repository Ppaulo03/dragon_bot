<div class="edit-form-wrapper fade-in">
    <header class="form-header">
        <h2>{{ "Editar: " ~ tmp.name if tmp else "Novo Template de CSV" }}</h2>
    </header>

    <div class="upload-test-zone">
        <div class="form-group">
            <label for="sample_csv">Selecione um arquivo de exemplo (CSV) para auto-mapeamento</label>
            <input type="file" id="sample_csv" name="sample_csv" accept=".csv" hx-post="/finance/templates/analyze-csv"
                hx-encoding="multipart/form-data" hx-trigger="change" hx-target="#template-fields-container"
                hx-swap="innerHTML" class="file-input-compact">

            <div id="upload-spinner" class="htmx-indicator">
                <span class="spinner-small"></span> Analisando estrutura...
            </div>
        </div>
    </div>

    <form action="/finance/templates/save" method="POST" class="dragon-form">
        {% if tmp %}<input type="hidden" name="template_id" value="{{ tmp.id }}">{% endif %}

        <div class="form-row">
            <div class="form-group">
                <label>Nome do Template</label>
                <input type="text" name="name" value="{{ tmp.name if tmp else '' }}" placeholder="Ex: Nubank Fatura"
                    required>
            </div>
            <div class="form-group">
                <label>Regex Nome do Arquivo</label>
                <input type="text" name="csv_name_pattern" value="{{ tmp.csv_name_pattern if tmp else '' }}"
                    placeholder="extrato_.*\.csv">
            </div>
        </div>

        <div id="template-fields-container">
            {% include "partials/template_fields.j2" %}
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">
                <span>ðŸ’¾</span> {{ "Salvar Template" if tmp else "Criar Template" }}
            </button>
            {% if tmp %}
            <button type="button" class="btn-danger-outline" hx-delete="/finance/templates/{{ tmp.id }}"
                hx-confirm="Excluir?">
                Deletar
            </button>
            {% endif %}
        </div>
    </form>
</div>
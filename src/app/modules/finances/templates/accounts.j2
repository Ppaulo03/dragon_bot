{% extends "layout.j2" %}

{% block extra_head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static_finance', path='css/accounts_manager.css') }}">
<script src="https://unpkg.com/htmx.org@1.9.12"></script>
{% endblock %}

{% block finance_content %}
<div class="admin-container">
    <div class="admin-grid">
        <aside class="admin-card list-sidebar">
            <div class="card-header">
                <h2><span>üè¶</span> Contas</h2>
                <button class="btn-new-account" hx-get="/finance/accounts/new" hx-target="#edit-container">
                    + Nova
                </button>
            </div>

            <div class="account-selector-list">
                {% for acc in accounts %}
                <div class="account-item" hx-get="/finance/accounts/edit/{{ acc.id }}" hx-target="#edit-container"
                    hx-swap="innerHTML transition:true">
                    <div class="acc-info">
                        <span class="acc-name">{{ acc.name }}</span>
                        <span class="acc-amount">R$ {{ "%.2f"|format(acc.initial_balance_cents / 100) }}</span>
                    </div>
                    <span class="chevron">‚Ä∫</span>
                </div>
                {% else %}
                <div class="empty-list">
                    <p class="text-muted">Nenhuma conta cadastrada.</p>
                </div>
                {% endfor %}
            </div>
        </aside>

        <section class="admin-card edit-area" id="edit-container">
            <div class="empty-state">
                <p>Selecione uma conta √† esquerda para editar os detalhes ou criar uma nova.</p>
            </div>
        </section>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Highlight da conta selecionada
    document.body.addEventListener('htmx:afterOnLoad', function (evt) {
        if (evt.detail.target.id === 'edit-container') {
            // Remove active de todos e adiciona no clicado
            document.querySelectorAll('.account-item').forEach(el => el.classList.remove('active'));
            if (evt.detail.elt.classList.contains('account-item')) {
                evt.detail.elt.classList.add('active');
            }
        }
    });
</script>
{% endblock %}
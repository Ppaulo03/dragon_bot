{% extends "base.j2" %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', path='css/pages/triggers-editor.css') }}">
{% endblock %}

{% block content %}
{% from "macros/rule_card.j2" import render_rule_card with context %}

<form id="main-form" action="/trigger-config" enctype="multipart/form-data">
    <div class="form-header">

        <div class="header-brand">
            <h2 style="margin: 0; font-size: 1.4rem;">üê≤ Dragon Bot</h2>
        </div>

        <div class="header-actions">
            <nav class="tabs-nav">
                <button type="button" data-tab-target="tab-triggers" id="btn-tab-triggers" class="tab-btn active">
                    Triggers
                </button>
                <button type="button" data-tab-target="tab-no-triggers" id="btn-tab-no-triggers" class="tab-btn">
                    Fallbacks
                </button>
            </nav>

            <button type="button" onclick="window.saveAll()" class="btn-primary">
                üíæ Salvar Altera√ß√µes
            </button>
        </div>
    </div>

    <div id="tab-triggers" class="tab-content active">
        <div id="container-triggers" class="rules-container">
            {% for t in triggers %}
            {{ render_rule_card(t, 'trigger', options, loop.index0, storage_url) }}
            {% endfor %}
        </div>
        <button type="button" onclick="addCard('trigger')" class="btn btn-outline">
            ‚ûï Novo Trigger
        </button>
    </div>

    <div id="tab-no-triggers" class="tab-content" style="display: none;">
        <div id="container-no-triggers" class="rules-container">
            {% for t in no_triggers %}
            {{ render_rule_card(t, 'no_trigger', options, loop.index0 + 1000) }}
            {% endfor %}
        </div>
        <button type="button" onclick="addCard('no-trigger')" class="btn btn-outline">
            ‚ûï Novo Fallback
        </button>
    </div>
</form>

<template id="template-rule-card">
    {{ render_rule_card({}, 'trigger', options, 'NEW') }}
</template>
{% endblock %}

{% block extra_scripts %}
<script type="module" src="{{ url_for('static', path='js/main.js') }}"></script>
{% endblock %}